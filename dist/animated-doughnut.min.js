window.AnimatedDoughnut={},function(){var t=function(t,e){var n=this;n.doughnut=t,n.index=e,n.drawComplete=!1,n.init()};t.prototype.init=function(){var t=this;t.data=t.doughnut.data.data[t.index],t.label=t.data.label||"",t.value=t.data.value,t.animationDuration=t.value/t.doughnut.data.total*t.doughnut.options.animationDuration,t.animationProgress=0,t.arcStart=0==t.index?1.5*Math.PI:t.doughnut.segments[t.index-1].arcEnd,t.arcCenter=t.arcStart+2*Math.PI*(t.value/2/t.doughnut.data.total),t.arcEnd=t.arcStart+2*Math.PI*(t.value/t.doughnut.data.total)},t.prototype.update=function(){var t=this,e=t.doughnut;(0==t.index||e.segments[t.index-1].drawComplete)&&(null==t.startTime&&(t.startTime=e.time),t.animationProgress=AnimatedDoughnut.EasingFunctions.easeInCubic((e.time-t.startTime)/t.animationDuration),t.animationProgress>1&&(t.animationProgress=1))},t.prototype.draw=function(){var t=this,e=t.doughnut,n=e.ctx,a=t.arcStart+2*Math.PI*(t.value/e.data.total)*t.animationProgress;n.moveTo(e.centerX,e.centerY),n.beginPath(),n.arc(e.centerX,e.centerY,e.outerRadius,t.arcStart,a,!1),n.lineTo(e.centerX,e.centerY),n.fillStyle=t.data.color,n.closePath(),n.fill(),a==t.arcEnd&&(t.drawComplete=!0),e.options.hollowPercentage>0&&e.hollowOut(),e.options.legendBar.width>0&&t.drawComplete&&t.drawLegendBarLabel()},t.prototype.drawLegendBarLabel=function(){var t=this,e=t.doughnut,n=e.ctx;spotCenterX=e.centerX+e.legendBarRadius*Math.cos(t.arcCenter),spotCenterY=e.centerY+e.legendBarRadius*Math.sin(t.arcCenter),segmentCenterX=e.centerX+e.outerRadius*Math.cos(t.arcCenter),segmentCenterY=e.centerY+e.outerRadius*Math.sin(t.arcCenter),n.beginPath(),n.moveTo(segmentCenterX,segmentCenterY),n.lineTo(spotCenterX,spotCenterY),n.strokeStyle=t.data.color,n.stroke(),n.beginPath(),n.arc(spotCenterX,spotCenterY,e.options.legendBar.spotRadius,0,2*Math.PI,!1),n.fillStyle=t.data.color,n.fill(),n.beginPath(),n.font="normal normal "+e.options.font.weight+" "+e.options.font.size+"px "+e.options.font.family,n.fillStyle=e.options.font.color,n.textBaseline="middle",t.arcCenter>=2.5*Math.PI&&t.arcCenter<=3.5*Math.PI?(textAlign="right",textStartX=spotCenterX-2*e.options.legendBar.spotRadius,textStartY=spotCenterY,t.arcCenter<=2.833*Math.PI?textStartY=spotCenterY+2*e.options.legendBar.spotRadius:t.arcCenter>=3.167*Math.PI&&(textStartY=spotCenterY-2*e.options.legendBar.spotRadius)):(textAlign="left",textStartX=spotCenterX+3.5*e.options.legendBar.spotRadius,textStartY=spotCenterY,t.arcCenter<=.833*Math.PI?textStartY=spotCenterY+2*e.options.legendBar.spotRadius:t.arcCenter>=2.167*Math.PI&&(textStartY=spotCenterY-2*e.options.legendBar.spotRadius)),n.textAlign=textAlign;for(var a=t.label.split(" "),i=0;i<a.length;i++)n.fillText(a[i],textStartX,i*e.options.font.size+textStartY)},AnimatedDoughnut.Segment=t}(),function(){var t=function(t,e){var n=this;n.elem=n.canvas=t,n.options=AnimatedDoughnut.apiDefaults.extend(e||{}),n.ctx=n.canvas.getContext("2d"),n.data=new AnimatedDoughnut.DataHelper(n.options.data),n.visible=!1,window.addEventListener("resize",function(){n.clearCanvas(),n.init()}),n.init()};t.prototype.init=function(){var t=this;t.animating=!1,t.animationComplete=!1,t.segments=[],t.width=t.height=t.elem.parentNode.offsetHeight,t.elem.width=t.width,t.elem.height=t.height,t.centerX=t.width/2,t.centerY=t.height/2,padding=t.options.padding+2*t.options.legendBar.width,t.width<t.height?t.legendBarRadius=(t.width-padding)/2:t.legendBarRadius=(t.height-padding)/2,t.outerRadius=t.legendBarRadius-t.options.legendBar.distancePercentage/100*t.legendBarRadius,t.hollowRadius=t.options.hollowPercentage/100*t.outerRadius;for(var e=0;e<t.data.data.length;e++)t.segments.push(new AnimatedDoughnut.Segment(t,e));t.elem.dataset.background&&t.setupBackground(),t.img&&t.calculateImagePosition(t.img.img),t.clearCanvas(),t.options.legendBar.width>0&&t.drawLegendBar(),(t.options.autostart||t.visible)&&setTimeout(function(){t.animate()},50)},t.prototype.setupBackground=function(){var t=this,e=new Image;e.onload=function(){t.calculateImagePosition(e)},e.src=t.elem.dataset.background},t.prototype.calculateImagePosition=function(t){var e=this,n=Math.atan2(-e.hollowRadius,-e.hollowRadius),a=e.centerX+Math.floor(e.hollowRadius*Math.cos(n)),i=e.centerY+Math.floor(e.hollowRadius*Math.sin(n)),o=Math.atan2(-e.hollowRadius,e.hollowRadius),r=e.centerX+Math.floor(e.hollowRadius*Math.cos(o));maxSize=r-a,e.img={img:t},t.width>t.height?(t.width=maxSize,t.height=t.height/t.width*maxSize,t.x=a,t.y=i+(maxSize-t.height/t.width*maxSize)/2):(t.width=t.width/t.height*maxSize,t.height=maxSize,t.x=a+(maxSize-t.width/t.height*maxSize)/2,t.y=i)},t.prototype.animate=function(){var t=this;t.animating=!0,t.update(),t.clearCanvas(),t.draw(),t.repeater=AnimatedDoughnut.requestAnimationFrame.call(window,function(){var e=!0;t.segments.forEach(function(t){t.drawComplete||(e=!1)}),e?(t.animating=!1,t.animationComplete=!0):t.animate()})},t.prototype.update=function(){var t=this;t.time=(new Date).getTime(),null==t.startTime&&(t.startTime=t.time),t.animationProgress=(t.time-t.startTime)/t.options.animationDuration,t.animationProgress>1&&(t.animationProgress=1),t.segments.forEach(function(t){t.update()})},t.prototype.draw=function(){var t=this;t.options.legendBar.width>0&&t.drawLegendBar(),t.segments.forEach(function(e,n){(0===n||t.segments[n-1].drawComplete)&&e.draw()})},t.prototype.clearCanvas=function(){var t=this;t.ctx.clearRect(0,0,t.width,t.height)},t.prototype.drawLegendBar=function(){var t=this;t.ctx.moveTo(t.centerX,t.centerY),t.ctx.beginPath(),t.ctx.arc(t.centerX,t.centerY,t.legendBarRadius,0,2*Math.PI,!1),t.ctx.lineWidth=t.options.legendBar.width,t.ctx.strokeStyle=t.options.legendBar.style,t.ctx.stroke(),t.img&&t.ctx.drawImage(t.img.img,t.img.x,t.img.y,t.img.width,t.img.height)},t.prototype.hollowOut=function(){var t=this;t.ctx.moveTo(t.centerX,t.centerY),t.ctx.beginPath(),t.ctx.arc(t.centerX,t.centerY,t.hollowRadius,0,2*Math.PI,!1),t.ctx.fillStyle="#f8f8f8",t.ctx.closePath(),t.ctx.fill(),t.img&&t.ctx.drawImage(t.img.img,t.img.x,t.img.y,t.img.width,t.img.height)},t.prototype.setVisibility=function(t){var e=this;e.visible!==t&&(e.visible=t,e.options.onVisibilityChange.call(e))},AnimatedDoughnut.Doughnut=t}(),function(){Object.prototype.extend=function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);return this};var t={data:[],autostart:!0,animationDuration:2e3,padding:160,hollowPercentage:65,font:{weight:"300",size:12,family:"Lato",color:"#666666"},legendBar:{width:2.5,style:"#666666",spotRadius:6,distancePercentage:35},onVisibilityChange:function(){}},e={linear:function(t){return t},easeInQuad:function(t){return t*t},easeOutQuad:function(t){return t*(2-t)},easeInOutQuad:function(t){return.5>t?2*t*t:-1+(4-2*t)*t},easeInCubic:function(t){return t*t*t},easeOutCubic:function(t){return--t*t*t+1},easeInOutCubic:function(t){return.5>t?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1},easeInQuart:function(t){return t*t*t*t},easeOutQuart:function(t){return 1- --t*t*t*t},easeInOutQuart:function(t){return.5>t?8*t*t*t*t:1-8*--t*t*t*t},easeInQuint:function(t){return t*t*t*t*t},easeOutQuint:function(t){return 1+--t*t*t*t*t},easeInOutQuint:function(t){return.5>t?16*t*t*t*t*t:1+16*--t*t*t*t*t}},n=function(t){var e=this;e.total=0,e.data="string"==typeof t?JSON.parse(t):t,e.init()};n.prototype.init=function(){var t=this;t.data.forEach(function(e){t.total+=e.value})};var a=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)};AnimatedDoughnut.requestAnimationFrame=a,AnimatedDoughnut.apiDefaults=t,AnimatedDoughnut.EasingFunctions=e,AnimatedDoughnut.DataHelper=n}();